### 3.5.24 应当开启BPF加固功能

**级别：** 要求

**适用版本：** 全部

**规则说明：**

BPF （Berkeley Packet Filter）是一个用于在运行时在内核中动态加载和执行字节码的系统。它用于许多 Linux 内核子系统，例如网络、跟踪和安全。BFP代码支持JIT编译执行和解释执行。其中JIT编译执行面临JIT喷射攻击的风险，攻击者可能利用该风险攻击内核进行提权。BPF加固功能会对JIT编译执行进行加固，缓解某些类型的JIT喷射攻击，降低内核面临的攻击风险。

**规则影响：**

开启BPF加固后，会导致执行性能降低以及牺牲BPF的部分跟踪调试能力。可根据实际需求对所有BPF代码开启加固或只对非特权BPF代码开启加固。

**检查方法：**

输入以下命令并检查返回的数值，其中0代表未开启加固，1代表对非特权代码开启加固，2代表对所有代码开启加固：

```bash
# cat /proc/sys/net/core/bpf_jit_harden
2
```

**修复方法：**

- 可以通过修改/proc/sys/net/core/bpf_jit_harden的值来开启BPF加固。请根据实际场景需求将值设置为1或2：

  ```bash
  # echo 2 > /proc/sys/net/core/bpf_jit_harden
  ```

- 或者通过修改/etc/sysctl.conf文件使其永久生效：

  ```bash
  net.core.bpf_jit_harden=2
  ```

  然后启用该配置：

  ```bash
  # sysctl -p /etc/sysctl.conf
  ```